{
  "version": 3,
  "sources": ["../../app/netlify/functions/utils/common.js", "../../app/netlify/functions/admin-control.js"],
  "sourceRoot": "/tmp/tmp-4423-P6ECFksra61x",
  "sourcesContent": ["// Standard Response Wrapper\nconst sendResponse = (success, data = null, error = null, statusCode = 200) => {\n    const origin = process.env.ALLOWED_ORIGIN || '*';\n    return {\n        statusCode,\n        headers: {\n            'Content-Type': 'application/json',\n            'Access-Control-Allow-Origin': origin,\n            'Access-Control-Allow-Headers': 'Content-Type',\n            'Access-Control-Allow-Methods': 'GET, POST, OPTIONS'\n        },\n        body: JSON.stringify({\n            success,\n            data,\n            error\n        })\n    };\n};\n\n// Simple In-Memory Cache\nconst cache = new Map();\nconst getCached = (key) => {\n    const item = cache.get(key);\n    if (!item) return null;\n    if (Date.now() > item.expiry) {\n        cache.delete(key);\n        return null;\n    }\n    return item.value;\n};\n\nconst setCached = (key, value, ttlSeconds = 60) => {\n    cache.set(key, {\n        value,\n        expiry: Date.now() + (ttlSeconds * 1000)\n    });\n};\n\n// Basic Rate Limiting (Memory Based - Per Instance)\nconst rateLimitMap = new Map();\nconst checkRateLimit = (ip, limit = 50, windowMs = 60000) => {\n    const now = Date.now();\n    const userStats = rateLimitMap.get(ip) || { count: 0, startTime: now };\n\n    if (now - userStats.startTime > windowMs) {\n        userStats.count = 1;\n        userStats.startTime = now;\n    } else {\n        userStats.count++;\n    }\n\n    rateLimitMap.set(ip, userStats);\n    return userStats.count <= limit;\n};\n\n// Input Validation\nconst isValidPaxiAddress = (address) => {\n    // Paxi addresses (bech32) are typically 44 or 64 characters\n    // Regex allows paxi1 prefix + 38 to 85 alphanumeric characters\n    return /^paxi1[0-9a-z]{38,85}$/.test(address);\n};\n\n// Admin State (Ephemeral)\nlet adminState = {\n    isFrozen: false,\n    blockedAddresses: []\n};\n\nconst getAdminState = () => adminState;\nconst updateAdminState = (newState) => {\n    adminState = { ...adminState, ...newState };\n    return adminState;\n};\n\nmodule.exports = {\n    sendResponse,\n    getCached,\n    setCached,\n    checkRateLimit,\n    isValidPaxiAddress,\n    getAdminState,\n    updateAdminState\n};\n", "const { sendResponse, getAdminState, updateAdminState, isValidPaxiAddress } = require('./utils/common');\n\nexports.handler = async (event) => {\n    if (event.httpMethod === 'OPTIONS') return sendResponse(true);\n\n    let currentState = getAdminState();\n\n    if (event.httpMethod === 'POST') {\n        try {\n            const body = JSON.parse(event.body || '{}');\n            const { action: bodyAction, value } = body;\n\n            switch (bodyAction) {\n                case 'freeze':\n                    currentState = updateAdminState({ isFrozen: !!value });\n                    break;\n                case 'block':\n                    if (value && isValidPaxiAddress(value)) {\n                        const blocked = new Set(currentState.blockedAddresses);\n                        blocked.add(value);\n                        currentState = updateAdminState({ blockedAddresses: Array.from(blocked) });\n                    } else if (value) {\n                        return sendResponse(false, null, 'Invalid address to block', 400);\n                    }\n                    break;\n                case 'unblock':\n                    if (value && isValidPaxiAddress(value)) {\n                        const blocked = currentState.blockedAddresses.filter(a => a !== value);\n                        currentState = updateAdminState({ blockedAddresses: blocked });\n                    }\n                    break;\n            }\n        } catch (e) {\n            return sendResponse(false, null, 'Invalid request body', 400);\n        }\n    }\n\n    return sendResponse(true, currentState);\n};\n"],
  "mappings": "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",
  "names": ["exports", "module", "sendResponse", "isValidPaxiAddress", "getAdminState", "updateAdminState"]
}
